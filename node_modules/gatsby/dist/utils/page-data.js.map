{"version":3,"sources":["../../src/utils/page-data.js"],"names":["fs","require","path","store","fixedPagePath","pagePath","getFilePath","publicDir","join","read","filePath","rawPageData","readFile","JSON","parse","remove","existsSync","Promise","resolve","write","page","result","body","componentChunkName","matchPath","bodyStr","stringify","pageDataSize","Buffer","byteLength","dispatch","type","payload","size","outputFile","module","exports"],"mappings":";;AAAA,MAAMA,EAAE,GAAGC,OAAO,CAAE,UAAF,CAAlB;;AACA,MAAMC,IAAI,GAAGD,OAAO,CAAE,MAAF,CAApB;;AACA,MAAM;AAAEE,EAAAA;AAAF,IAAYF,OAAO,CAAE,UAAF,CAAzB;;AAEA,MAAMG,aAAa,GAAGC,QAAQ,IAAKA,QAAQ,KAAM,GAAd,GAAoB,OAApB,GAA6BA,QAAhE;;AAEA,MAAMC,WAAW,GAAG,CAAC;AAAEC,EAAAA;AAAF,CAAD,EAAgBF,QAAhB,KAClBH,IAAI,CAACM,IAAL,CAAUD,SAAV,EAAsB,WAAtB,EAAkCH,aAAa,CAACC,QAAD,CAA/C,EAA4D,gBAA5D,CADF;;AAGA,MAAMI,IAAI,GAAG,OAAO;AAAEF,EAAAA;AAAF,CAAP,EAAsBF,QAAtB,KAAmC;AAC9C,QAAMK,QAAQ,GAAGJ,WAAW,CAAC;AAAEC,IAAAA;AAAF,GAAD,EAAgBF,QAAhB,CAA5B;AACA,QAAMM,WAAW,GAAG,MAAMX,EAAE,CAACY,QAAH,CAAYF,QAAZ,EAAuB,OAAvB,CAA1B;AACA,SAAOG,IAAI,CAACC,KAAL,CAAWH,WAAX,CAAP;AACD,CAJD;;AAMA,MAAMI,MAAM,GAAG,OAAO;AAAER,EAAAA;AAAF,CAAP,EAAsBF,QAAtB,KAAmC;AAChD,QAAMK,QAAQ,GAAGJ,WAAW,CAAC;AAAEC,IAAAA;AAAF,GAAD,EAAgBF,QAAhB,CAA5B;;AACA,MAAIL,EAAE,CAACgB,UAAH,CAAcN,QAAd,CAAJ,EAA6B;AAC3B,WAAO,MAAMV,EAAE,CAACe,MAAH,CAAUL,QAAV,CAAb;AACD;;AACD,SAAOO,OAAO,CAACC,OAAR,EAAP;AACD,CAND;;AAQA,MAAMC,KAAK,GAAG,OAAO;AAAEZ,EAAAA;AAAF,CAAP,EAAsBa,IAAtB,EAA4BC,MAA5B,KAAuC;AACnD,QAAMX,QAAQ,GAAGJ,WAAW,CAAC;AAAEC,IAAAA;AAAF,GAAD,EAAgBa,IAAI,CAAClB,IAArB,CAA5B;AACA,QAAMoB,IAAI,GAAG;AACXC,IAAAA,kBAAkB,EAAEH,IAAI,CAACG,kBADd;AAEXrB,IAAAA,IAAI,EAAEkB,IAAI,CAAClB,IAFA;AAGXsB,IAAAA,SAAS,EAAEJ,IAAI,CAACI,SAHL;AAIXH,IAAAA;AAJW,GAAb;AAMA,QAAMI,OAAO,GAAGZ,IAAI,CAACa,SAAL,CAAeJ,IAAf,CAAhB,CARmD,CASnD;;AACA,QAAMK,YAAY,GAAGC,MAAM,CAACC,UAAP,CAAkBJ,OAAlB,IAA6B,IAAlD;AAEAtB,EAAAA,KAAK,CAAC2B,QAAN,CAAe;AACbC,IAAAA,IAAI,EAAG,qBADM;AAEbC,IAAAA,OAAO,EAAE;AACPtB,MAAAA,QADO;AAEPuB,MAAAA,IAAI,EAAEN;AAFC;AAFI,GAAf;AAQA,QAAM3B,EAAE,CAACkC,UAAH,CAAcxB,QAAd,EAAwBe,OAAxB,CAAN;AACD,CArBD;;AAuBAU,MAAM,CAACC,OAAP,GAAiB;AACf3B,EAAAA,IADe;AAEfU,EAAAA,KAFe;AAGfJ,EAAAA,MAHe;AAIfX,EAAAA;AAJe,CAAjB","sourcesContent":["const fs = require(`fs-extra`)\nconst path = require(`path`)\nconst { store } = require(`../redux`)\n\nconst fixedPagePath = pagePath => (pagePath === `/` ? `index` : pagePath)\n\nconst getFilePath = ({ publicDir }, pagePath) =>\n  path.join(publicDir, `page-data`, fixedPagePath(pagePath), `page-data.json`)\n\nconst read = async ({ publicDir }, pagePath) => {\n  const filePath = getFilePath({ publicDir }, pagePath)\n  const rawPageData = await fs.readFile(filePath, `utf-8`)\n  return JSON.parse(rawPageData)\n}\n\nconst remove = async ({ publicDir }, pagePath) => {\n  const filePath = getFilePath({ publicDir }, pagePath)\n  if (fs.existsSync(filePath)) {\n    return await fs.remove(filePath)\n  }\n  return Promise.resolve()\n}\n\nconst write = async ({ publicDir }, page, result) => {\n  const filePath = getFilePath({ publicDir }, page.path)\n  const body = {\n    componentChunkName: page.componentChunkName,\n    path: page.path,\n    matchPath: page.matchPath,\n    result,\n  }\n  const bodyStr = JSON.stringify(body)\n  // transform asset size to kB (from bytes) to fit 64 bit to numbers\n  const pageDataSize = Buffer.byteLength(bodyStr) / 1000\n\n  store.dispatch({\n    type: `ADD_PAGE_DATA_STATS`,\n    payload: {\n      filePath,\n      size: pageDataSize,\n    },\n  })\n\n  await fs.outputFile(filePath, bodyStr)\n}\n\nmodule.exports = {\n  read,\n  write,\n  remove,\n  fixedPagePath,\n}\n"],"file":"page-data.js"}